
#selfweb3

[简体中文][1]

### A web3 solution that provides privatized guarantees for high security and data ownership on the chain. By forcing dynamic authorization, user assets are bound to themselves one-to-one instead of wallets, Zero-knowledge proof + webAuthn + TOTP + Association verification

![/docs/selfweb3.png](/docs/selfweb3.png)

## Contract

1. **Arbitrum Goerli, 421613: 0x7B6E05a55B1756f827F205BF454BF75288904ecF**

## Architecture

![/docs/selfweb3-arch.png](/docs/selfweb3-arch.png)

#### Description: The public and private key refers to the public and private key pair generated by elliptic curve secp256k1, the key refers to the 32-bit plaintext string, and dhKey refers to the shared key dynamically calculated through the private key and public key.

> - Contract: decentralized storage. Once registered and written, it cannot be changed. It supports wallet rebinding and relies on user private dynamic authorization instead of wallet public and private keys.

> - wasm: Provides key synthesis, TOTP verification and email verification services, and supports off-chain implementation of the associated verification mechanism. All operations need to rely on the decrypted web2 ciphertext.

> - Backend: web2 service, only provides targeted value-added services such as email sending and encrypted data storage and retrieval, no session, no state, only processing ciphertext data

> - TOTP: The TOTP key ciphertext is provided by the web2 service, and the web3 public key is partially decrypted by wasm, and the TOTP key is calculated and decrypted for dynamic verification

> - Email: Wasm is responsible for caching the dynamic verification code and completing the verification, and the web2 service is responsible for sending it

> - Frontend: web2, web3 interactive gateway, all web2 services and web3 dapp entry

## Features

### Association verification (off-chain proof generation + on-chain dynamic verification):

1. Implementation principle: The contract provides the basic leaf data for association verification and the merkle tree verification entrance. The off-chain is responsible for dynamically generating the merkle tree and corresponding certificates according to specific scenarios, and verifying the validity of the off-chain dynamic authorization according to fixed rules.
2. Realization purpose: It is mandatory to verify the validity of the dynamic authorization on the chain. Only when the verification passes can the ciphertext data stored on the chain be successfully obtained
3. Implementation method: The contract only provides basic random numbers, and the merkle tree is dynamically generated externally, which not only ensures on-chain verification but also supports flexible expansion

### web3 privatization (selfWeb3)

1. Forcibly bind the operation right on the web3 chain to the user himself, and the ownership of web3 data truly belongs to the user himself

2. Through methods such as webAuthn, TOTP, and mailbox verification, as well as the associated verification mechanism that generates on-chain verification under the chain, it is mandatory to improve the guarantee

3. Due to the mandatory binding of private dynamic authorization, the wallet only serves as a tool to interact with web3 contracts, but by default it also supports off-chain request signatures and is verified by on-chain contracts, and supports rebinding the wallet after private dynamic authorization.

### Privatization of user data ownership (web3 contract)

1. The contract is responsible for storing the key ciphertext used for dynamic authorization verification, including recovery ID signature (web3 private key signature, web3 private key discard), web3 key ciphertext (dhKey encryption), web3 public key ciphertext (web2 public key encryption)

2. Responsible for dynamically verifying user identities and operating legality to confirm rights, including wallet signature verification and associated verification chain verification

3. Responsible for providing specific web3 services, including private treasury, private NFT collection and other web3 data of users, etc.

### Privacy and Security Computing (WebAssembly)

1. The wasm part serves as a privacy and security computing node, responsible for processing all plaintext computing tasks and dynamic verification logic. At the same time, all operations rely on the web2 service key that supports self-reset to support user data privacy and security.

2. The legality of wasm files is temporarily guaranteed by the official, and supports dynamic verification completed by the cooperation of web2 services and web3 contracts, including the generation of off-chain file legality certificates and on-chain dynamic verification.

3. The webAuthn data is encrypted and stored by the wasm part using a random key. The random key decryption depends on the web3 key on the chain. The key extraction needs to pass the dynamic verification on the chain.

4. The web2 service and the wasm part use temporary asymmetric ecdsa key pair to calculate the shared key for point-to-point encrypted communication

### Zero trust web2 service

1. The core code is open source and supports private deployment of services.

2. In order to ensure high-strength security, only stateless services related to ciphertext are provided, and there is no session

3. Only as a centralized node to improve user experience, after user ciphertext data is stored in IPFS, it is also stored in web2 service for quick retrieval

4. As a zero-trust centralized service, it only provides storage and extraction of web2-related ciphertext data, as well as targeted business value-added services based on user ciphertext

## Privatized dynamic authorization

> - web3 SSO: Powered by Sismo Connect, it does not participate in association verification, and zero-knowledge proof is generated off-chain to verify the legitimacy of user identity on the chain.

> - WebAuthn: Provides credential ciphertext support by web2 services and ceramic stores, participates in associated verification, and verifies the validity of dynamic authorization on the chain

> - Social Email: wasm is responsible for caching the dynamic verification code and completing the verification, the web2 service is responsible for sending it, participating in the association verification, and the dynamic authorization validity is verified on the chain

> - TOTP: The web3 public key is partially decrypted by wasm, the TOTP key is calculated and decrypted, and then dynamically verified, participates in association verification, and verifies the validity of dynamic authorization on the chain.

## Association verification process

> - Contract: verifyRandom (random number used for association verification, only written during registration and cannot be modified, will be used as a leaf to participate in merkle tree verification)

> - Registration: Generate a random number for association verification, write it into the contract, encrypt it and store it in the web2 service, and back it up to ceramic storage.

> - Verification: The wasm part generates the proof and the root of the merkle tree based on the decrypted verifyRandom, following the rules of email + step + 1, TOTP + step + 2, webAuthn + step + 3, and the contract generates the root of the merkle tree based on the incoming proof, root, step And stored verifyRandom for merkle tree verification

## Core business process

> - Support privatized web3 business process operations after all dynamic verification through wallet signature, private dynamic authorization, and association verification

### web2 mode

1. Support data reading and writing to web3 contract and ceramic store, the private dynamic authorization process needs to pass the associated verification, that is, web3 SSO -> TOTP -> webAuthn

2. The web2 service key is a random key generated by the back-end web2 service. It also supports inputting a 32-bit string as the web2 service key, but it needs to be entered every time the web is loaded.

3. The web3 public key is encrypted by the web2 public key and stored in the web3 contract, which is used to dynamically calculate and synthesize the dhKey with the web2 private key. Once registered and written into the contract, it cannot be changed

4. The web3 key is encrypted by dhKey and stored in the web3 contract, which is used to encrypt user data and store it in IPFS and web2 services, such as webAuthn related data

5. The web2 private key is randomly generated by the wasm part, and is used to dynamically calculate and synthesize the dhKey with the web3 public key, which is encrypted by the web2 service key and copied to the user's mailbox

6. The reset function includes TOTP, web2 service keys and user wallets. All reset operations will enable a complete association verification process to strengthen security protection.

7. For dapp business, all related operations that need to be written into the web3 contract require TOTP and webAuthn dynamic verification, and sensitive operations will trigger email verification

### web3 mode

1. Support data reading and writing to web3 contract and ceramic store, the private dynamic authorization process needs to pass the associated verification, that is, web3 SSO -> TOTP -> webAuthn

2. The web2 service is only used as a centralized node to improve user experience. If the user chooses not to use it or the service fails, the user ciphertext will be extracted from the ceramic stor

3. Since there is no web2 service support, you need to enter the web2 private key ciphertext and optional web2 service key yourself (if you have reset the web2 service key by yourself)

4. Since there is no web2 service support, the email verification function will be limited temporarily, but it will not affect the normal operation of web3 business

5. Does not support registration and all recovery and reset functions, only supports association verification except email verification

### Private deployment

```shell
git clone https://github.com/refitor/selfweb3.git

cd selfweb3

chmod +x ./build.sh

./build.sh
```

### use

```
./selfweb3
```

[1]: /docs/README-zh.md